/*
unChart constructor takes two constructor arguments, the width and height of the chart.
.build( selector ) must be called with a selector for the parent element.
finally, set the baseline property to define the chart ranges/domains and draw the baseline;
setting the dataset property will update the chart and draw the new data.

*/function unChart(e,t){this.w=e;this.h=t;this.padding={left:60,right:30,top:30,bottom:30};this.innerWidth=this.w-this.padding.left-this.padding.right;this.innerHeight=this.h-this.padding.top-this.padding.bottom;this.innerTop=this.h-this.padding.top;this.data=this.base={data:"default"};this.speed=300;this.sliderValue=0;this.dScale=d3.time.scale().range([this.padding.left,this.w-this.padding.right]);this.yScale=d3.scale.linear().range([this.innerTop,this.padding.bottom]);this.xAxis=d3.svg.axis().scale(this.dScale).orient("bottom").ticks(5);this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").ticks(5).tickFormat(function(e){return e+"%"});this.svg=null;this.sliderX=null;this.container=null;this.slideAxis=d3.svg.axis().scale(this.dScale).orient("bottom").ticks(5);this.line=d3.svg.line()}p=unChart.prototype;p.build=function(e){e=typeof e!="undefined"?e:"body";this.container=d3.select(e);this.svg=this.container.append("svg").attr({width:this.w,height:this.h,"class":"chart"});gutter=5;clipPad=this.padding.left+gutter;this.clip=this.svg.append("defs").append("clipPath").attr("id","clip").append("svg:rect").attr("id","clip-rect").attr({x:clipPad,y:0}).attr({width:this.innerWidth-gutter,height:this.h});this.chartBody=this.svg.append("g").attr("clip-path","url(#clip)");this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(this.h-this.padding.bottom)+")").call(this.xAxis);this.svg.append("g").attr("class","y axis").attr("transform","translate("+this.padding.left+",0)").call(this.yAxis);this.chartBody.append("path").attr("class"," line current");this.chartBody.append("path").attr("class"," line base")};Object.defineProperty(p,"dataset",{get:function(){return this.data},set:function(e){this.data=e;console.log("DATASET RECEIVED");this.update()}});Object.defineProperty(p,"baseline",{get:function(){return this.base},set:function(e){this.base=e;console.log("DATASET RECEIVED");this.drawBase()}});p.update=function(){_base=this.base;scaleMin=d3.max(this.data,function(e,t){return Math.max(e.value,_base[t].value)});scaleMax=d3.min(this.data,function(e,t){return Math.min(e.value,_base[t].value)});this.yScale.domain([scaleMin,scaleMax]);this.dScale.domain(d3.extent(this.data,function(e){return e.jsDate}));this.yAxis.scale(this.yScale);this.xAxis.scale(this.dScale);this.svg.select(".x.axis").transition().duration(this.speed).call(this.xAxis);this.svg.select(".y.axis").transition().duration(this.speed).call(this.yAxis);this.chartBody.select(".line.current").datum(this.data).transition().duration(this.speed).attr("d",this.line);this.chartBody.select(".line.base").datum(this.base).transition().duration(this.speed).attr("d",this.line);$.event.trigger({type:"SLIDER",observation:this.data[this.sliderValue],base:this.base[this.sliderValue]})};p.drawBase=function(){console.log("drawing Baseline");console.log("updating domains");this.dScale.domain(d3.extent(this.base,function(e,t){return e.jsDate}));this.yScale.domain(d3.extent(this.base,function(e){return parseFloat(e.value)}));console.log("line function");ds=this.dScale;ys=this.yScale;this.line.x(function(e){return ds(e.jsDate)}).y(function(e){return ys(e.value)}).interpolate("cardinal");this.svg.select(".x.axis").transition().duration(this.speed).call(this.xAxis);this.svg.select(".y.axis").transition().duration(this.speed).call(this.yAxis);console.log("Current Position : "+this.sliderValue);this.slide=d3.slider().min(0).max(this.base.length-1);this.container.select(".d3-slider").remove();var e=this,t=function(t,n){e.sliderValue=n;$.event.trigger({type:"SLIDER",observation:e.data[n],base:e.base[n]})};this.container.append("div").attr("class","x axis slider").style({width:this.innerWidth,"margin-left":this.padding.left-1}).call(this.slide.value(this.sliderValue));this.slide.on("slide",t);var n=this.container.select(".d3-slider-handle");n.append("div").attr("class","arrow left");n.append("div").attr("class","arrow right");this.svg.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("x",-this.h/3).attr("dy",".75em").attr("transform","rotate(-90)").text("(Percent)");this.svg.select(".x.axis").transition().duration(this.speed).call(this.xAxis);this.svg.select(".y.axis").transition().duration(this.speed).call(this.yAxis);this.chartBody.select(".line.base").datum(this.base).transition().duration(this.speed).attr("d",this.line)};